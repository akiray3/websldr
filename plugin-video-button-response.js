var jsPsychVideoButtonResponse=function(e){"use strict";function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r={name:"video-button-response",parameters:{stimulus:{type:e.ParameterType.VIDEO,pretty_name:"Video",default:void 0,array:!0},choices:{type:e.ParameterType.STRING,pretty_name:"Choices",default:void 0,array:!0},button_html:{type:e.ParameterType.HTML_STRING,pretty_name:"Button HTML",default:'<button class="jspsych-btn">%choice%</button>',array:!0},prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},width:{type:e.ParameterType.INT,pretty_name:"Width",default:""},height:{type:e.ParameterType.INT,pretty_name:"Height",default:""},autoplay:{type:e.ParameterType.BOOL,pretty_name:"Autoplay",default:!0},controls:{type:e.ParameterType.BOOL,pretty_name:"Controls",default:!1},start:{type:e.ParameterType.FLOAT,pretty_name:"Start",default:null},stop:{type:e.ParameterType.FLOAT,pretty_name:"Stop",default:null},rate:{type:e.ParameterType.FLOAT,pretty_name:"Rate",default:1},trial_ends_after_video:{type:e.ParameterType.BOOL,pretty_name:"End trial after video finishes",default:!1},trial_duration:{type:e.ParameterType.INT,pretty_name:"Trial duration",default:null},margin_vertical:{type:e.ParameterType.STRING,pretty_name:"Margin vertical",default:"0px"},margin_horizontal:{type:e.ParameterType.STRING,pretty_name:"Margin horizontal",default:"8px"},response_ends_trial:{type:e.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},response_allowed_while_playing:{type:e.ParameterType.BOOL,pretty_name:"Response allowed while playing",default:!0}}},n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jsPsych=t}var r,n,a;return r=e,(n=[{key:"trial",value:function(e,t){var r=this;if(!Array.isArray(t.stimulus))throw new Error("\n        The stimulus property for the video-button-response plugin must be an array\n        of files. See https://www.jspsych.org/latest/plugins/video-button-response/#parameters\n      ");var n="<div>";n+='<video id="jspsych-video-button-response-stimulus"',t.width&&(n+=' width="'+t.width+'"'),t.height&&(n+=' height="'+t.height+'"'),t.autoplay&&null==t.start&&(n+=" autoplay "),t.controls&&(n+=" controls "),null!==t.start&&(n+=' style="visibility: hidden;"'),n+=">";var a=this.jsPsych.pluginAPI.getVideoBuffer(t.stimulus[0]);if(!a)for(var s=0;s<t.stimulus.length;s++){var i=t.stimulus[s];i.indexOf("?")>-1&&(i=i.substring(0,i.indexOf("?")));var o=i.substr(i.lastIndexOf(".")+1);"mov"==(o=o.toLowerCase())&&console.warn("Warning: video-button-response plugin does not reliably support .mov files."),n+='<source src="'+i+'" type="video/'+o+'">'}n+="</video>",n+="</div>";var l=[];if(Array.isArray(t.button_html))t.button_html.length==t.choices.length?l=t.button_html:console.error("Error in video-button-response plugin. The length of the button_html array does not equal the length of the choices array");else for(s=0;s<t.choices.length;s++)l.push(t.button_html);for(n+='<div id="jspsych-video-button-response-btngroup">',s=0;s<t.choices.length;s++){var u=l[s].replace(/%choice%/g,t.choices[s]);n+='<div class="jspsych-video-button-response-button" style="cursor: pointer; display: inline-block; margin:'+t.margin_vertical+" "+t.margin_horizontal+'" id="jspsych-video-button-response-button-'+s+'" data-choice="'+s+'">'+u+"</div>"}n+="</div>",null!==t.prompt&&(n+=t.prompt),e.innerHTML=n;var p=performance.now(),y=e.querySelector("#jspsych-video-button-response-stimulus");a&&(y.src=a),y.onended=function(){t.trial_ends_after_video?h():t.response_allowed_while_playing||f()},y.playbackRate=t.rate,null!==t.start&&(y.pause(),y.onseeked=function(){y.style.visibility="visible",y.muted=!1,t.autoplay?y.play():y.pause(),y.onseeked=function(){}},y.onplaying=function(){y.currentTime=t.start,y.onplaying=function(){}},y.muted=!0,y.play());var c=!1;null!==t.stop&&y.addEventListener("timeupdate",(function(e){y.currentTime>=t.stop&&(t.response_allowed_while_playing||f(),y.pause(),t.trial_ends_after_video&&!c&&(c=!0,h()))})),t.response_allowed_while_playing?f():v();var d={rt:null,button:null},h=function(){r.jsPsych.pluginAPI.clearAllTimeouts(),e.querySelector("#jspsych-video-button-response-stimulus").pause(),e.querySelector("#jspsych-video-button-response-stimulus").onended=function(){};var n={rt:d.rt,stimulus:t.stimulus,response:d.button};e.innerHTML="",r.jsPsych.finishTrial(n)};function m(e){!function(e){var r=performance.now(),n=Math.round(r-p);d.button=parseInt(e),d.rt=n,y.className+=" responded",v(),t.response_ends_trial&&h()}(e.currentTarget.getAttribute("data-choice"))}function v(){for(var e=document.querySelectorAll(".jspsych-video-button-response-button"),t=0;t<e.length;t++){var r=e[t].querySelector("button");r&&(r.disabled=!0),e[t].removeEventListener("click",m)}}function f(){for(var e=document.querySelectorAll(".jspsych-video-button-response-button"),t=0;t<e.length;t++){var r=e[t].querySelector("button");r&&(r.disabled=!1),e[t].addEventListener("click",m)}}null!==t.trial_duration&&this.jsPsych.pluginAPI.setTimeout(h,t.trial_duration)}},{key:"simulate",value:function(e,t,r,n){"data-only"==t&&(n(),this.simulate_data_only(e,r)),"visual"==t&&this.simulate_visual(e,r,n)}},{key:"create_simulation_data",value:function(e,t){var r={stimulus:e.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:this.jsPsych.randomization.randomInt(0,e.choices.length-1)},n=this.jsPsych.pluginAPI.mergeSimulationData(r,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,n),n}},{key:"simulate_data_only",value:function(e,t){var r=this.create_simulation_data(e,t);this.jsPsych.finishTrial(r)}},{key:"simulate_visual",value:function(e,t,r){var n=this,a=this.create_simulation_data(e,t),s=this.jsPsych.getDisplayElement();this.trial(s,e),r();var i=s.querySelector("#jspsych-video-button-response-stimulus"),o=function(){null!==a.rt&&n.jsPsych.pluginAPI.clickTarget(s.querySelector('div[data-choice="'.concat(a.response,'"] button')),a.rt)};e.response_allowed_while_playing?o():i.addEventListener("ended",o)}}])&&t(r.prototype,n),a&&t(r,a),Object.defineProperty(r,"prototype",{writable:!1}),e}();return n.info=r,n}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map